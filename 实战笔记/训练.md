# 训练

## 数据集分割

`train_test_split(X, y) -> X_train, X_test, y_train, y_test`

`data_tfidf` 和 `data["spam"]` 应该是列表类对象

```python
seed = 42
from sklearn.model_selection import train_test_split

data_tfidf_train, data_tfidf_test, label_train, label_test = train_test_split(data_tfidf, data["spam"], test_size=0.3,
                                                                              random_state=seed)
```

## 交叉验证

kfold

```python
from sklearn.model_selection import KFold, StratifiedKFold

folds = 4
seed = 666
kf = StratifiedKFold(n_splits=folds, shuffle=True, random_state=seed)
model = []
for train_index, val_index in kf.split(train, train['building_id']):  # train 全数据表
    train_X = train[feat_cols].iloc[train_index]
    val_X = train[feat_cols].iloc[val_index]
    train_y = target.iloc[train_index]
    val_y = target.iloc[val_index]
    lgb_train = lgb.Dataset(train_X, train_y, categorical_feature=categoricals)
```

## 网格超参搜索

```python
from sklearn.model_selection import GridSearchCV
from sklearn.neighbors import KNeighborsClassifier

parameters_KNN = {'n_neighbors': (10, 15, 17), }
grid_KNN = GridSearchCV(KNeighborsClassifier(), parameters_KNN, cv=5,
                        n_jobs=-1, verbose=1)
grid_KNN.fit(data_tfidf_train, label_train)

print(grid_KNN.best_params_)
print(grid_KNN.best_score_)
```

精度作为网格搜索的指标

- accuracy@dafault
- precision
- recall

```python
scoring = 'precision'
grid_KNN = GridSearchCV(pipe_KNN, parameters_KNN, cv=5,
                          scoring=scoring, n_jobs=-1, verbose=1)
```

## Pipline

simple Pipeline. no optimization

```python
from sklearn.naive_bayes import MultinomialNB
from sklearn.pipeline import Pipeline
from sklearn.feature_extraction.text import CountVectorizer, TfidfTransformer

pipe_MNB = Pipeline([('bow', CountVectorizer(analyzer=remove_punctuation_and_stopwords)),
                     ('tfidf', TfidfTransformer()),
                     ('clf_MNB', MultinomialNB()),
                     ])
pipe_MNB.fit(X=sms_train, y=label_train)
pred_test_MNB = pipe_MNB.predict(sms_test)

acc_MNB = accuracy_score(label_test, pred_test_MNB)
print(acc_MNB)
print("")
print(pipe_MNB.score(sms_test, label_test))
```